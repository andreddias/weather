<html lang="pt-br">

<head>
    <title>Encontre o centro de saúde</title>
    <meta charset="UTF-8">
    <meta name="description" content="Encontre o centro de saúde que deseja">
    <meta name="keywords" content="Centro de saúde">

    <body>
        <h3>Centro de saúde</h3>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <p id="hoje"></p>

    <div>
            <select name="selectFreguesia" id="selectFreguesia" onchange="freguesiaSelecionada();">
            </select>
    </div>
</br>
  
    <table id="tabela" class="table table-striped">
        <div class ="col-md-6">
        <th>atividade</th>
        <th width="400">morada</th>
        </div>
    </table>

    <style>
/*https://developer.mozilla.org/pt-BR/docs/Web/Guide/HTML/Forms/Meu_primeiro_formulario_HTML    */

    form {
        /* Apenas para centralizar o form na página */
        margin: 0 auto;
        /* Para ver as bordas do formulário */
        padding: 1em;
        border: 1px solid #CCC;
        border-radius: 1em;
    }
    form div + div {
        margin-top: 1em;
    }
</style>
    
        <script language="JavaScript" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script>
            var url = "https://services.arcgis.com/1dSrzEWVQn5kHHyK/ArcGIS/rest/services/POISaude/FeatureServer/0/query?where=1%3D1&outFields=*&f=pgeojson";           
            var hoje = dataAtual();
            $("#hoje").append("Hoje é " + hoje + "<br>");

            var freguesias = ["Alvalade", "Avenidas Novas", "Alcântara", "Ajuda", "Arroios", "Areeiro", "Ajuda", "Belém", "Benfica", "Campo de Ourique", "Carnide", "Campolide", "Estrela", "Lumiar", "Olivais", "Marvila", "Misericórdia", "Olivais", "Penha de França", "Santo António", "São Vicente", "São Domingos de Benfica", "Santa Maria Maior"];

            $('#selectFreguesia').empty();
            $('#selectFreguesia').append('<option selected="true" disabled>Escolha a freguesia</option>');
            $.each(freguesias, function(i, p) {
            $('#selectFreguesia').append($('<option></option>').val(p).html(p));
            });

            function freguesiaSelecionada(){

                if  (selectFreguesia.selectedIndex != 0){
                var freguesia = document.getElementById("selectFreguesia").value;

	                $.getJSON(url, function(data) { 
        	            $.each(data, function(key, value) {
                	      var valor = JSON.stringify(value);
	              	      carregarCombo(value, freguesia);
                    	     });
                 	});
                }
            }

            function carregarCombo(value, freguesia) {
		    if (typeof value === "string") {
			    return undefined; 
                    }
		    for (var i = 0; i < value.length; i++) {
                    //return value[0];            
                    //value[0].geometry
                    //var freguesia = value[i].properties.FREGUESIA; 
                    var atividade = value[i].properties.ACTIVIDADE_NOME; 
                    var morada = value[i].properties.MORADA; 	
			    if (freguesia === value[i].properties.FREGUESIA){ 
				    $("#tabela").append('<tr><td>'+atividade+'</td><td>'+morada+'</td></tr>');
			    };
                    }

            }
				
            function dataAtual() {
                var hoje = new Date();
                var dd = hoje.getDate();
                var mm = hoje.getMonth() + 1; //January is 0!
                var yyyy = hoje.getFullYear();
                var dia = hoje.getDay();
                var semana = new Array(6);
                semana[0] = 'Domingo';
                semana[1] = 'Segunda-Feira';
                semana[2] = 'Terça-Feira';
                semana[3] = 'Quarta-Feira';
                semana[4] = 'Quinta-Feira';
                semana[5] = 'Sexta-Feira';
                semana[6] = 'Sábado';
                diaSemana = semana[dia];
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                hoje = dd + '/' + mm + '/' + yyyy;
                var hoje = diaSemana + " dia " + hoje;
                return hoje;
            }

        </script>
    </body>
</head>

</html>
